<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="auto_update_by_hierarchy">
 <title>Централизованное обновление Комплексов по иерархии</title>
 <body>
  <p>
   <note id="note_wsg_pyx_lvb" type="attention">Перед началом обновления убедитесь в наличии у вас
    необходимых полномочий для обновления параметров сети, таких как: открытие TCP-портов 25500,
    443; резервация подсети для обновления.</note>
  </p>
  <p>Централизованное обновление выполняется в следующем порядке:</p>
  <ol id="ol_nqy_g5x_lvb">
   <li>Отправка обновлений.</li>
   <li>Обновление <term keyref="appliance"/>а верхнего уровня.</li>
   <li>Обновление  <term keyref="appliance"/>а среднего уровня, возобновление работы иерархии.</li>
   <li>Обновление  <term keyref="appliance"/>а базового уровня, возобновление работы иерархии. </li>
   <li>Обновление всех имеющихся <term keyref="appliance"/>ов.</li>
  </ol>
    <p>Обновить можно только <term keyref="appliance"/>ы версии 1.18. При наличии ранних версий
      необходимо произвести обновление сначала до версии 1.18.0.1. В процессе обновления произойдет
      перенос существующих ролей пользователей в соответствии с принципом, представленным в таблице ниже<ph outputclass="onlypdf"> (<xref href="#auto_update_by_hierarchy/table_qn5_sbw_nvb"/>)</ph>.</p>
   
     <table frame="all" rowsep="1"
          colsep="1" id="table_qn5_sbw_nvb">
          <title>Принцип переноса ролей пользователя</title>
          <tgroup cols="2">
            <colspec colname="c1" colnum="1" colwidth="1*"/>
            <colspec colname="c2" colnum="2" colwidth="1*"/>
            <thead>
              <row>
                <entry>Назначенные пользователю роли</entry>
                <entry>Принцип переноса</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry>Пользовательская роль, поставляемая производителем <term keyref="appliance"
              />а</entry>
                <entry>Без изменений (полный перенос)</entry>
              </row>
          <row>
            <entry>Несколько пользовательских ролей, поставляемых производителем <term
                keyref="appliance"/>а</entry>
            <entry>Без изменений (полный перенос)</entry>
          </row>
              <row>
                <entry>Пользовательские роли, содержащие роли, поставляемые производителем <term
                    keyref="appliance"/>а и базовые роли</entry>
                <entry>Перенос только пользовательских ролей, поставляемых производителем <term
                    keyref="appliance"/>а</entry>
              </row>
              <row>
                <entry>Пользовательские роли, содержащие только базовые роли</entry>
                <entry>Присваевается роль «Администратор»</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
    
  <p>Для обновления используется версия 1.2.1 сервиса обновлений. При работе сервис обновления по
      умолчанию использует подсеть 172.8.0.0/24. При необходимости подсеть можно изменить.</p>
 <p>Файлы, необходимые для обновления: </p>
 
 <ul>
 <li>архив <codeph>updater1-2-1.tar.gz</codeph> с файлами для корректной работы сервиса
    автоматического обновления, который в дальнейшем необходимо будет скопировать на каждый <term
     keyref="appliance"/> в иерархии;</li>
 <li>файлы <codeph>docker-compose.release.yml</codeph> новой версии (данный файл различается для
          <term keyref="appliance"/>ов, расположенных на разных уровнях иерархии), которые в
        дальнейшем необходимо будет скопировать на вышестоящий <term keyref="appliance"/> для
        обновления <term keyref="appliance"/>ов всех уровней иерархии;</li>
 <li>файлы <codeph>docker-compose.release.yml</codeph> и <codeph>docker-compose.stand.yml</codeph> (и другие необходимые файлы, например, директории <codeph>NGUI</codeph> и <codeph>logstash</codeph>; для <term keyref="appliance"/>ов разных уровней иерархии указанные файлы различаются), которые в дальнейшем необходимо будет скопировать на каждый <term keyref="appliance"/> при завершении обновления;</li>
 <li>архив с образами новой версии <codeph>datapk_v[номер_версии].tar.gz</codeph> (на нижестоящие <term keyref="appliance"/>ы образы будут отправляться через сервис автоматического обновления), который в дальнейшем необходимо будет скопировать на вышестоящий <term keyref="appliance"/>.</li>
 </ul>
 <p>Подготовьте указанные файлы для копирования на соответствующие <term keyref="appliance"/>ы в
   иерархии по протоколу SSH (SFTP) (при наличии удаленного доступа к комплексам) или с
   использованием USB-носителя (при отсутствии удаленного доступа к комплексам).</p>
 </body>
</topic>
